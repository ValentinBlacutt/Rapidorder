<!-- Views/Shared/_Layout.cshtml -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Restaurante</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/Layout.css" />
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                    <i class="fas fa-utensils"></i> Rapidorder
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="navbar-nav ms-auto">
                        <a class="nav-link" asp-controller="Home" asp-action="Index">
                            <i class="fas fa-home"></i> Inicio
                        </a>
                        <a class="nav-link" asp-controller="Home" asp-action="Menu">
                            <i class="fas fa-book"></i> Menú
                        </a>
                        <a class="nav-link position-relative" asp-controller="Carrito" asp-action="Index">
                            <i class="fas fa-shopping-cart"></i> Carrito
                            <span id="cartCount" class="badge cart-badge">0</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main role="main" class="container">
        @RenderBody()
    </main>

    <footer class="text-white py-4">
        <div class="container text-center">
            <p><i style="color: #ff6b6b;"></i> Rapidorder - Todos los derechos reservados</p>
        </div>

        <!-- Enlace escondido - texto pequeño y transparente -->
        <div class="mt-2">
            <a href="/AdminAuth/Login" class="text-white-50" style="font-size: 0.7rem; opacity: 0.3; text-decoration: none;">
                Admin
            </a>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Actualizar contador del carrito con animación
        function actualizarContadorCarrito() {
            $.get('/Carrito/GetCartCount', function(data) {
                const $cartCount = $('#cartCount');
                const newCount = parseInt(data) || 0;
                const oldCount = parseInt($cartCount.text()) || 0;

                if (newCount !== oldCount) {
                    $cartCount.addClass('animate__animated animate__bounceIn');
                    setTimeout(() => {
                        $cartCount.removeClass('animate__animated animate__bounceIn');
                    }, 1000);
                }

                $cartCount.text(newCount);

                // Ocultar badge si es 0
                if (newCount === 0) {
                    $cartCount.hide();
                } else {
                    $cartCount.show();
                }
            }).fail(function() {
                console.error('Error al obtener el contador del carrito');
            });
        }

        // Llamar al cargar la página
        $(document).ready(function() {
            actualizarContadorCarrito();

            // Actualizar cada 30 segundos
            setInterval(actualizarContadorCarrito, 30000);
        });

        // Función global para actualizar el carrito desde otras páginas
        window.actualizarCarrito = actualizarContadorCarrito;
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>